<!DOCTYPE html>
<html>
  <head>
    <title><%= content_for(:title) || "Lookbook" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= yield :head %>

    <%# Enable PWA manifest for installable apps (make sure to enable in config/routes.rb too!) %>
    <%#= tag.link rel: "manifest", href: pwa_manifest_path(format: :json) %>

    <link rel="icon" href="/icon.png" type="image/png">
    <link rel="icon" href="/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/icon.png">

    <%= stylesheet_link_tag "lightning_ui_kit", media: "all" %>
    <%= javascript_include_tag "lightning_ui_kit" %>
    <script>
      (function() {
        var stored = localStorage.getItem("lui-theme");
        var prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
        if (stored === "dark" || (!stored && prefersDark)) {
          document.documentElement.classList.add("lui-theme-dark");
        }
      })();
    </script>
  </head>

  <body style="padding: <%= lookbook_display(:body_padding, '20px') %>; background: var(--lui-theme-surface); color: var(--lui-theme-foreground); transition: background 0.2s, color 0.2s;">
    <button
      id="lui-theme-toggle"
      type="button"
      style="position: fixed; bottom: 12px; right: 12px; z-index: 9999; width: 36px; height: 36px; border-radius: 50%; border: 1px solid var(--lui-theme-border-strong); background: var(--lui-theme-surface-secondary); cursor: pointer; display: flex; align-items: center; justify-content: center; box-shadow: 0 1px 3px rgba(0,0,0,0.12);"
      title="Toggle dark/light theme"
    >
      <svg id="lui-icon-sun" width="18" height="18" viewBox="0 0 20 20" fill="currentColor" style="color: var(--lui-theme-foreground-muted); display: none;">
        <path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zM4.222 4.222a1 1 0 011.414 0l.707.707a1 1 0 01-1.414 1.414l-.707-.707a1 1 0 010-1.414zm11.556 0a1 1 0 010 1.414l-.707.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM10 7a3 3 0 100 6 3 3 0 000-6zm-7 3a1 1 0 011-1h1a1 1 0 110 2H4a1 1 0 01-1-1zm13 0a1 1 0 011-1h1a1 1 0 110 2h-1a1 1 0 01-1-1zM5.636 14.364a1 1 0 011.414 0l.707.707a1 1 0 01-1.414 1.414l-.707-.707a1 1 0 010-1.414zm9.435 0a1 1 0 010 1.414l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 0zM10 16a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1z" clip-rule="evenodd"/>
      </svg>
      <svg id="lui-icon-moon" width="18" height="18" viewBox="0 0 20 20" fill="currentColor" style="color: var(--lui-theme-foreground-muted);">
        <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"/>
      </svg>
    </button>
    <%= yield %>
    <script>
      (function() {
        var toggle = document.getElementById("lui-theme-toggle");
        var sunIcon = document.getElementById("lui-icon-sun");
        var moonIcon = document.getElementById("lui-icon-moon");

        function updateIcons() {
          var isDark = document.documentElement.classList.contains("lui-theme-dark");
          sunIcon.style.display = isDark ? "block" : "none";
          moonIcon.style.display = isDark ? "none" : "block";
        }

        updateIcons();

        toggle.addEventListener("click", function() {
          var isDark = document.documentElement.classList.toggle("lui-theme-dark");
          localStorage.setItem("lui-theme", isDark ? "dark" : "light");
          updateIcons();
        });
      })();
    </script>
  </body>
</html>
