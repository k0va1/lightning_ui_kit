# LightningUiKit

> LightningUiKit is a Ruby gem providing UI components for Rails applications, built on ViewComponent with Tailwind CSS styling and Stimulus controllers for interactivity.

Important notes:

- All Tailwind CSS classes **MUST** be prefixed with `lui:` (e.g., `lui:px-4`, `lui:text-foreground`, `lui:hover:bg-surface-hover`)
- Components extend `LightningUiKit::BaseComponent` and use ViewComponent patterns
- Interactive components use Stimulus controllers registered under the `lui-` namespace
- Uses TailwindMerge for intelligent CSS class conflict resolution via `merge_classes()` helper
- **Theming**: All color classes use semantic design tokens (e.g., `lui:bg-surface`, `lui:text-foreground`) instead of hardcoded Tailwind colors. Tokens are defined as CSS custom properties in `themes.css`

## Architecture

### Component Structure

Every component follows this pattern:

```ruby
# app/components/lightning_ui_kit/example_component.rb
class LightningUiKit::ExampleComponent < LightningUiKit::BaseComponent
  def initialize(required_param:, optional_param: default_value, **options)
    @required_param = required_param
    @optional_param = optional_param
    @options = options  # Captures extra attributes for flexibility
  end

  def classes
    merge_classes(["lui:base-classes", @options[:class]].compact.join(" "))
  end

  def data_attributes
    { controller: "lui-example" }.merge(@options[:data] || {})
  end
end
```

```erb
<%# app/components/lightning_ui_kit/example_component.html.erb %>
<%= tag.div(class: classes, data: data_attributes) do %>
  <%= content %>
<% end %>
```

### Stimulus Controller Pattern

```javascript
// app/javascript/lightning_ui_kit/controllers/example_controller.js
import { Controller } from "@hotwired/stimulus"

export default class extends Controller {
  static targets = ["element"]
  static values = { active: Boolean, position: String }

  connect() {
    // Setup logic
  }

  toggle() {
    // Action logic
  }
}
```

Register in `app/javascript/lightning_ui_kit/index.js`:
```javascript
application.register(`${namespace}-example`, ExampleController)
```

## Available Components

### Form Components
- **ButtonComponent** - `style: :default/:outline/:destructive`, `size: :default/:small`, `disabled:`, `url:` (renders as link)
- **InputComponent** - `name:`, `type: :text/:email/:password/:number/:date/:datetime`, `label:`, `form:`, `error:`, `description:`, `placeholder:`, `min:`, `max:`
- **TextareaComponent** - `name:`, `label:`, `form:`, `rows:`, `error:`
- **CheckboxComponent** - `name:`, `label:`, `checked:`, `form:`
- **SwitchComponent** - `name:`, `label:`, `checked:`, `enabled:`
- **SelectComponent** - `name:`, `options:`, `label:`, `form:`, `multiple:`
- **ComboboxComponent** - `name:`, `options:`, `label:`, `form:`, `multiple:`, `allow_custom:`, `url:` (async), `placeholder:`, `selected:`, `min_chars:`, `debounce:`, `association:`, `foreign_key:`, `nested_model:`, `collection:`, `label_method:`, `value_method:`
- **FileInputComponent** - `name:`, `label:`, `accept:`, `error:`
- **DropzoneComponent** - Drag-and-drop file upload with ActiveStorage integration

### Display Components
- **TextComponent** - `size: :sm/:md/:lg`
- **BadgeComponent** - `style: :default/:success/:warning/:error`, progress indicator support
- **AvatarComponent** - `src:`, `initials:`, `size: :sm/:md/:lg`, `square:`
- **AlertComponent** - `type:` for different alert styles
- **BannerComponent** - `type: :info/:error`, with header/footer slots
- **ToastComponent** - `timeout:` for auto-dismiss, notification styling
- **SkeletonComponent** - `title:`, `lines:` for loading states
- **SpinnerComponent** - Loading spinner

### Structural Components
- **TableComponent** - `data:`, `actions_title:`, `empty_message:` with column/action slots
- **PaginationComponent** - Page navigation with smart gap rendering
- **DescriptionListComponent** - Key-value list with item slots
- **DropdownComponent** - `trigger_text:`, `anchor:`, `position:` with item slots
- **ModalComponent** - `id:`, `title:`, `description:`, `open:` with body/actions slots
- **TooltipComponent** - `text:`, `position: :top/:bottom/:left/:right`, `active:`
- **LayoutComponent** - `sidebar_width:` with header/sections/sidebar/footer/mobile_header slots for app shell layout
- **SidebarSectionComponent** - `title:` - Groups sidebar links with optional section title
- **SidebarLinkComponent** - `title:`, `url:`, `icon:`, `current:`, `animate_icon:` - Navigation link with Heroicon support, active state, and optional icon bounce animation on hover
- **SidebarComponent** - Sidebar layout
- **LinkComponent** - Styled link wrapper

## Component Composition

### Slots API

Use `renders_one` and `renders_many` for component composition:

```ruby
class LightningUiKit::ModalComponent < LightningUiKit::BaseComponent
  renders_one :body
  renders_many :actions

  def initialize(id:, title:, description: nil, open: false, **options)
    # ...
  end
end
```

Usage:

Add this line to your application's Gemfile:

```ruby
gem "propshaft"
gem "lightning_ui_kit"
```

And then execute:
```bash
$ bundle
```

Add the following lines to your `application.html.erb` file:
```erb
<%= stylesheet_link_tag "lightning_ui_kit" %>
<%= javascript_include_tag "lightning_ui_kit" %>
```

Then you can use components in your views like this:

```erb
<%= render LightningUiKit::ButtonComponent.new(text: "Click me!") %>
```

### Using the `lui` Helper (Recommended)

The `lui` helper provides a convenient shorthand for rendering components:

```erb
<%# Instead of this: %>
<%= render LightningUiKit::ButtonComponent.new { "Click me" } %>

<%# You can write: %>
<%= lui.button { "Click me" } %>
```

Available helper methods:
- `lui.alert`, `lui.avatar`, `lui.badge`, `lui.banner`, `lui.button`
- `lui.checkbox`, `lui.combobox`, `lui.description_list`, `lui.dropdown`, `lui.dropzone`
- `lui.file_input`, `lui.input`, `lui.layout`, `lui.link`, `lui.modal`
- `lui.pagination`, `lui.select`, `lui.sidebar`, `lui.sidebar_link`, `lui.sidebar_section`
- `lui.skeleton`, `lui.spinner`, `lui.switch`, `lui.table`, `lui.text`
- `lui.textarea`, `lui.toast`, `lui.tooltip`

All arguments and blocks are passed directly to the component:

```erb
<%= lui.button(style: :destructive, size: :small) { "Delete" } %>

<%= lui.input(name: :email, type: :email, label: "Email", form: form) %>

<%= lui.modal(id: "confirm", title: "Confirm") do |modal| %>
  <% modal.with_body do %>
    <p>Are you sure?</p>
  <% end %>
  <% modal.with_action do %>
    <%= lui.button(style: :outline) { "Cancel" } %>
  <% end %>
  <% modal.with_action do %>
    <%= lui.button { "Confirm" } %>
  <% end %>
<% end %>
```

### Table with Dynamic Columns

```erb
<%= lui.table(data: @users) do |table| %>
  <% table.with_column("Name") { |user| user.name } %>
  <% table.with_column("Email") { |user| user.email } %>
  <% table.with_action { |user| link_to "Edit", edit_user_path(user) } %>
<% end %>
```

### Dropdown Menu

```erb
<%= lui.dropdown(trigger_text: "Options") do |dropdown| %>
  <% dropdown.with_item do %>
    <%= link_to "Edit", "#", class: "lui:block lui:px-4 lui:py-2" %>
  <% end %>
  <% dropdown.with_item do %>
    <%= link_to "Delete", "#", class: "lui:block lui:px-4 lui:py-2" %>
  <% end %>
<% end %>
```

## Form Integration

### With Rails Form Builder

```erb
<%= form_with model: @user do |form| %>
  <%= lui.input(name: :email, type: :email, label: "Email Address", form: form, placeholder: "user@example.com") %>
  <%= lui.textarea(name: :bio, label: "Biography", form: form, rows: 4) %>
  <%= lui.button(type: :submit) { "Save" } %>
<% end %>
```

### Error Handling

Components include `LightningUiKit::Errors` module for automatic validation error display:

```erb
<%# Errors are automatically extracted from form object %>
<%= lui.input(name: :email, form: form, error: @user.errors[:email].first) %>
```

## Theming

LightningUiKit uses CSS custom properties for theming. All components use semantic design tokens instead of hardcoded Tailwind color classes.

### Available Themes

- **Default (light)** - Applied automatically via `:root` CSS variables
- **Dark** - Applied by adding `class="lui-theme-dark"` to a container element

```erb
<%# Light theme (default) %>
<body>
  <%= lui.button { "Click me" } %>
</body>

<%# Dark theme %>
<body class="lui-theme-dark">
  <%= lui.button { "Click me" } %>
</body>
```

### Semantic Design Tokens

| Token | Purpose | Example Usage |
|-------|---------|---------------|
| `surface` | Primary background | `lui:bg-surface` |
| `surface-secondary` | Secondary background | `lui:bg-surface-secondary` |
| `surface-tertiary` | Tertiary background | `lui:bg-surface-tertiary` |
| `surface-invert` | Inverted background | `lui:bg-surface-invert` |
| `surface-hover` | Hover background | `lui:hover:bg-surface-hover` |
| `foreground` | Primary text | `lui:text-foreground` |
| `foreground-secondary` | Secondary text | `lui:text-foreground-secondary` |
| `foreground-muted` | Muted text | `lui:text-foreground-muted` |
| `foreground-invert` | Inverted text | `lui:text-foreground-invert` |
| `border` | Default border | `lui:border-border` |
| `border-hover` | Hover border | `lui:border-border-hover` |
| `border-subtle` | Subtle border | `lui:border-border-subtle` |
| `focus` | Focus ring | `lui:focus:outline-focus` |
| `interactive` | Interactive accent | `lui:bg-interactive` |
| `destructive` | Destructive actions | `lui:bg-destructive` |
| `destructive-border` | Destructive border | `lui:border-destructive-border` |
| `destructive-text` | Destructive text | `lui:text-destructive-text` |
| `success-bg` | Success background | `lui:bg-success-bg` |
| `warning-bg` | Warning background | `lui:bg-warning-bg` |

### Custom Themes

Create custom themes by overriding CSS custom properties:

```css
.my-custom-theme {
  --lui-theme-surface: oklch(0.98 0.01 250);
  --lui-theme-foreground: oklch(0.2 0.02 250);
  --lui-theme-interactive: oklch(0.6 0.2 250);
  /* ... override any --lui-theme-* variable */
}
```

```erb
<body class="my-custom-theme">
  <%= lui.button { "Themed button" } %>
</body>
```

### Token File Location

Theme definitions are in `app/assets/stylesheets/lightning_ui_kit/themes.css`. Token registration for Tailwind is in `app/assets/stylesheets/lightning_ui_kit/application.css`.

## Styling Guide

### Critical: lui: Prefix

**ALL Tailwind classes must use the `lui:` prefix:**

```erb
<%# Correct %>
<div class="lui:px-4 lui:py-2 lui:text-foreground lui:hover:bg-surface-hover">

<%# WRONG - will not work %>
<div class="px-4 py-2 text-foreground hover:bg-surface-hover">
```

### Responsive and State Variants

```erb
lui:sm:px-3              <%# Responsive %>
lui:hover:bg-surface-hover  <%# Hover state %>
lui:focus:ring-2         <%# Focus state %>
lui:disabled:opacity-50  <%# Disabled state %>
lui:data-invalid:border-destructive-border  <%# Data attribute state %>
```

### Using merge_classes()

The `merge_classes()` helper from TailwindMerge resolves class conflicts:

```ruby
def classes
  class_list = ["lui:px-4 lui:py-2"]
  class_list << "lui:bg-blue-500" if @primary
  class_list << @options[:class]  # User overrides
  merge_classes(class_list.compact.join(" "))
end
```

### Data Slots for Layout

Use `data-slot` attributes for semantic structure:

```erb
<label data-slot="label">Email</label>
<p data-slot="description">We'll never share your email</p>
<span data-slot="control"><input /></span>
<p data-slot="error">Invalid email</p>
```

CSS handles relationships:
```css
lui:[&>[data-slot=label]+[data-slot=control]]:mt-3
```

## Stimulus Controllers

All controllers use `lui-` prefix:

| Controller | Purpose | Key Features |
|------------|---------|--------------|
| `lui-dropdown` | Toggle dropdown visibility | Animations via stimulus-use |
| `lui-layout` | Mobile sidebar toggle | Animated drawer, backdrop overlay |
| `lui-modal` | Dialog control | Native `<dialog>`, form handling |
| `lui-tooltip` | Floating tooltips | @floating-ui/dom positioning |
| `lui-switch` | Toggle state | True/false field binding |
| `lui-checkbox` | Checkbox state | Visual state updates |
| `lui-toast` | Auto-dismiss notifications | Configurable timeout |
| `lui-banner` | Banner close | Fade animation |
| `lui-dropzone` | File uploads | ActiveStorage direct upload |
| `lui-accordion` | Expand/collapse | Single-open enforcement |
| `lui-clipboard` | Copy to clipboard | navigator.clipboard API |
| `lui-combobox` | Autocomplete/typeahead | Floating UI, keyboard nav, async filtering |
| `lui-jsonb` | JSONB field editor | Key-value pairs, array mode, auto-serialization |

### Binding Controllers

```erb
<div data-controller="lui-dropdown">
  <button data-action="click->lui-dropdown#toggle">Menu</button>
  <div data-lui-dropdown-target="menu">...</div>
</div>
```

## Examples

### Button Variants

```erb
<%= lui.button { "Submit" } %>
<%= lui.button(style: :outline) { "Cancel" } %>
<%= lui.button(style: :destructive) { "Delete" } %>
<%= lui.button(size: :small) { "Edit" } %>
<%= lui.button(url: "/dashboard") { "Go to Dashboard" } %>
<%= lui.button(disabled: true) { "Loading..." } %>
```

### Input with All Options

```erb
<%= lui.input(
  name: :username,
  type: :text,
  label: "Username",
  description: "Choose a unique username",
  placeholder: "john_doe",
  autofocus: true,
  form: form
) %>
```

### Tooltip

```erb
<%= lui.tooltip(text: "This is helpful information", position: :top) do %>
  <button>Hover me</button>
<% end %>
```

### Toast Notification

```erb
<%= lui.toast(timeout: 5000) do %>
  <p>Your changes have been saved!</p>
<% end %>
```

### Combobox (Autocomplete)

```erb
<%# Single selection with client-side filtering %>
<%= lui.combobox(
  name: :country,
  label: "Country",
  placeholder: "Search countries...",
  options: [
    { value: "us", label: "United States" },
    { value: "uk", label: "United Kingdom" },
    { value: "ca", label: "Canada" }
  ]
) %>

<%# Multiple selection %>
<%= lui.combobox(
  name: :tags,
  label: "Tags",
  multiple: true,
  allow_custom: true,
  selected: ["ruby", "rails"],
  options: [
    { value: "ruby", label: "Ruby" },
    { value: "rails", label: "Rails" },
    { value: "javascript", label: "JavaScript" }
  ]
) %>

<%# Server-side filtering %>
<%= lui.combobox(name: :user_id, label: "User", url: "/api/users/search", min_chars: 2, debounce: 300) %>

<%# Nested attributes for has_many :through associations (SimpleForm-inspired) %>
<%= form_with model: @post do |f| %>
  <%= lui.combobox(
    form: f,
    association: :post_tags,
    foreign_key: :tag_id,
    nested_model: :tag,
    collection: Tag.all,
    label_method: :name,
    value_method: :id,
    allow_custom: true,
    label: "Tags",
    placeholder: "Search or create tags..."
  ) %>
<% end %>
```

### Layout with Sidebar

```erb
<%= lui.layout do |layout| %>
  <% layout.with_sidebar do %>
    <div class="lui:p-4">
      <div class="lui:flex lui:items-center lui:mb-6">
        <span class="lui:text-xl lui:font-semibold">My App</span>
      </div>
      <nav class="lui:flex lui:flex-col lui:gap-1">
        <a href="#" class="lui:px-3 lui:py-2 lui:rounded-lg lui:bg-zinc-100">Home</a>
        <a href="#" class="lui:px-3 lui:py-2 lui:rounded-lg lui:hover:bg-zinc-50">Settings</a>
      </nav>
    </div>
  <% end %>

  <% layout.with_footer do %>
    <div class="lui:p-4">
      <p class="lui:text-sm lui:text-zinc-500">Logged in as user@example.com</p>
    </div>
  <% end %>

  <% layout.with_mobile_header do %>
    <span class="lui:font-semibold">My App</span>
  <% end %>

  <h1 class="lui:text-2xl lui:font-bold">Dashboard</h1>
  <p>Main content goes here</p>
<% end %>
```

### Layout with Sidebar Sections

```erb
<%= lui.layout do |layout| %>
  <% layout.with_header do %>
    <div class="lui:flex lui:items-center lui:gap-2">
      <%= image_tag "logo.svg", class: "lui:h-6" %>
      <span class="lui:font-semibold">My App</span>
    </div>
  <% end %>

  <% layout.with_section do |section| %>
    <% section.with_link(title: "Search", url: "/search", icon: "magnifying-glass") %>
    <% section.with_link(title: "Inbox", url: "/inbox", icon: "inbox") %>
  <% end %>

  <% layout.with_section do |section| %>
    <% section.with_link(title: "Home", url: "/", icon: "home", current: true) %>
    <% section.with_link(title: "Events", url: "/events", icon: "calendar") %>
    <% section.with_link(title: "Settings", url: "/settings", icon: "cog-6-tooth") %>
  <% end %>

  <% layout.with_section(title: "Upcoming Events") do |section| %>
    <% section.with_link(title: "Bear Hug: Live in Concert", url: "/events/1") %>
    <% section.with_link(title: "Viking People", url: "/events/2") %>
  <% end %>

  <% layout.with_footer do %>
    <div class="lui:p-4">
      <%= lui.sidebar_link(title: "Support", url: "/support", icon: "question-mark-circle") %>
    </div>
  <% end %>

  <p>Main content here</p>
<% end %>
```

## File Structure

```
app/
├── components/lightning_ui_kit/
│   ├── base_component.rb           # Base class with helpers
│   ├── button_component.rb         # Ruby class
│   ├── button_component.html.erb   # Template
│   └── ...
├── javascript/lightning_ui_kit/
│   ├── controllers/
│   │   ├── dropdown_controller.js
│   │   ├── modal_controller.js
│   │   └── ...
│   └── index.js                    # Controller registration
└── assets/stylesheets/
    └── lightning_ui_kit/
        ├── application.css         # Tailwind entry point with token registration
        └── themes.css              # Theme definitions (light/dark CSS custom properties)
```

## Dependencies

- **Rails 8.0+** - Framework
- **ViewComponent** - Component architecture
- **TailwindMerge** - CSS class conflict resolution
- **Heroicons** - SVG icons (via `heroicon()` helper)
- **Stimulus** - JavaScript interactivity
- **@floating-ui/dom** - Tooltip/dropdown positioning
- **stimulus-use** - Animation utilities

## Creating New Components

1. Create Ruby class extending `LightningUiKit::BaseComponent`
2. Create `.html.erb` template in same directory
3. Use `merge_classes()` for class handling
4. Add Stimulus controller if interactive (register in index.js)
5. Prefix all Tailwind classes with `lui:`
5b. Use semantic design tokens for colors (e.g., `lui:bg-surface`, `lui:text-foreground`) — never hardcode colors like `lui:bg-zinc-900`
6. Add preview in `lookbook/app/previews/`
7. **Add method to `lib/lightning_ui_kit/builder.rb` for the `lui` helper**
8. **Update this llms.txt file with the new component**

## Commands

```bash
make install     # Install dependencies
make start       # Development server with asset watching
make docs        # Lookbook preview server
make test        # Run RSpec tests
make build       # Build production assets
```
